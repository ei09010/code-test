<!DOCTYPE html>
<html>
  <head>
    <title>Bootstrap 101 Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <!-- Latest compiled and minified CSS -->
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

      <!-- Optional theme -->
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
      
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

      <style type="text/css">
body {
  padding-top: 40px;
  padding-bottom: 40px;
  background-color: #eee;
}

.form-details {
  max-width: 330px;
  padding: 15px;
  margin: 0 auto;
}
.form-details .form-details-heading,
.form-details .checkbox {
  margin-bottom: 10px;
}
.form-details .checkbox {
  font-weight: normal;
}
.form-details .form-control {
  position: relative;
  height: auto;
  padding: 10px;
  font-size: 16px;
}
.form-details .form-control:focus {
  z-index: 2;
}
      </style>
  </head>
  <body>

    <div class="container">

      <form class="form-details" method="post">

        <h2 class="form-details-heading">Details</h2>

        <label for="inputEmail" class="sr-only">Email address</label>
        <input type="email" id="inputEmail" class="form-control" 
        placeholder="Email address" required autofocus>

        <label for="inputCardNumber" class="sr-only">Card Number</label>
        <input type="text" id="inputCardNumber" class="form-control" 
        placeholder="Card Number" required>

        <label for="inputCVV" class="sr-only">CVV</label>
        <input type="text" id="inputCVV" class="form-control" 
        placeholder="Security Code" required>

        <div class="checkbox">
          <label>
            <input type="checkbox" value="agree"> Agree to Terms
          </label>
        </div>

        <button class="btn btn-lg btn-primary btn-block" type="submit" >Submit</button>
      </form>

    </div> <!-- /container -->

    <script>

var domainURl = "http://localhost:8080"
var sessionId = ""

$(document).ready(function () {

    $.ajax({
      url: domainURl +'/session',
      type: 'POST',
      data: JSON.stringify({webSiteUrl: document.URL}),
     success: function (data) {
         //alert(data.SessionId)
         sessionId = data.SessionId;

         // sessionId should go to cookie to avoid constant requests to server
        //

         //windowResizeEventListener
         windowResizeEventListener()

        // copyPasteEvent
        copyPasteEventListener()

         // timeTakenEventListener
         timeTakenEventListener()

     },
     error: function (error) {
       alert("Error during session: " + JSON.stringify(error))
     }
    })
  });

  function windowResizeEventListener(){

    var oldWidth =  $(window).width().toString();
    var oldHeight = $(window).height().toString();
    var newWidth;
    var newHeight;

    $(window).resize(function(){

      newWidth = $(window).width().toString();
      newHeight = $(window).height().toString();
    
      resizeEvent = {
                eventType: "resizeEvent",
                websiteUrl: document.URL,
                sessionId: sessionId,
                resizeFrom: {
                    width : oldWidth,
                    height : oldHeight,
                },
                resizeTo:   {
                    width: newWidth,
                    height : newHeight,
                }
                
      }

      postInfo(resizeEvent, "/screenresize")

      // screen resize event is to be recorded only once
      $(window).off()
      
    });
    
    };

  function copyPasteEventListener(){
    var formId

    $('input').on('paste', function () { //Attach paste event handler for all inputs
    formId = $(this).attr('id'); // get formId from current on paste form

    copyPasteEvent = {
                eventType: "copyAndPaste",
                websiteUrl: document.URL,
                sessionId: sessionId,
                pasted: true,
                formId: formId
      }

      postInfo(copyPasteEvent, "/copypaste")
    });
  }

//   {
//   "eventType": "copyAndPaste",
//   "websiteUrl": "https://ravelin.com",
//   "sessionId": "123123-123123-123123123",
//   "pasted": true,
//   "formId": "inputCardNumber"
// }


//     {
//   "eventType": "resizeEvent",
//   "websiteUrl": "https://ravelin.com",
//   "sessionId": "18ac7f09-75fd-c392-e9c5-7a137f29fdd1",
//   "resizeFrom": {"width": "","height": "12"},
//   "resizeTo": {"width": "12","height": "12"}
// }

  function postInfo(eventData, resource){
    $.ajax({
      url: domainURl + resource,
      type: 'POST',
      data: JSON.stringify(eventData),
     success: function (data) {
     },
     error: function (error) {
       alert(error)
     }
    });
  }
  
   </script>



  </body>
</html>